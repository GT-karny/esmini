# 残課題 (Remaining Issues)

## Phase 3 実装時の残検証・課題

### 1. Initアクションの適用と永続化 (Fog: 0 の原因)
*   **現象**: デルタ解析で `Init` フェーズのアクションとしてロードされた `AppearanceAction`（フォグランプ点灯）が、シミュレーションログ上で `0` (OFF) のままとなっている。
*   **分析**: `GT_ScenarioReader` でアクションを手動実行 (`Start(0.0)`) していますが、その後の `esmini` の初期化プロセスや最初の `Step` 更新のタイミングで、状態がリセットまたは上書きされている可能性があります。
*   **現在の方針**: AutoLightのコア機能（動的制御）には影響しないため、Phase 3としては完了とするが、Initアクションの完全な互換性を目指す場合は、`GT_Init` とシミュレーションループ開始の間の状態管理を調査し、拡張アクションの効果が確実に持続するように適用タイミングを見直す必要があります。

### 2. ブレーキランプロジックの最適化
*   **現象**: バック走行開始時（0km/hから後方へ加速）に、負の加速度が発生するためブレーキランプが一瞬点灯する。
*   **分析**: 物理的には「負の加速度」ですが、ドライバーの操作としては「アクセル（リバース）」であり、ブレーキは踏んでいません。
*   **対策案**: ギアがリバースに入っている、あるいは速度と加速度の符号が一致している（加速中である）場合はブレーキランプを点灯させないよう、判定ロジックを洗練させる必要があります。

### 3. インジケーター制御の高度化
*   **現状**: レーンチェンジ検知はステートレス（その瞬間の状態のみで判定）です。
*   **課題**: 実際の車のような「3回点滅」や「完了まで維持」といったステートフルな挙動は未実装です。これらはUX向上や厳密なシミュレーションにおいて重要となる可能性があります。

### 4. ユニットテストの未実装
*   **現状**: 統合テスト (`autolight_test.xosc`) により機能検証を行いましたが、C++レベルでの `AutoLightController` 単体テストは実装されていません。
*   **方針**: 機能が複雑化した場合、リグレッション防止のために単体テストフレームワーク（Google Test等）の導入を検討すべきです。
